<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="En"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>MSAB</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">

        <!-- Google fonts link-->
        <link href="https://fonts.googleapis.com/css?family=Kaushan+Script&amp;subset=latin-ext" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">

        <link rel="stylesheet" href="assets/css/font-awesome.min.css">
        <link rel="stylesheet" href="assets/css/bootstrap.min.css">

        <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'>
        <link rel='stylesheet' href='https://unpkg.com/formiojs@latest/dist/formio.full.min.css'>

        <script src='https://unpkg.com/formiojs@latest/dist/formio.full.min.js'></script>

        <!--For Plugins external css-->
        <link rel="stylesheet" href="assets/css/plugins.css" />

        <!--Theme custom css -->
        <link rel="stylesheet" href="assets/css/style.css">

        <!--Theme Responsive css-->
        <link rel="stylesheet" href="assets/css/responsive.css" />

        <script src="assets/js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
    </head>
    <body data-spy="scroll" data-target=".navbar-collapse">
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
        <div class='preloader'><div class='loaded'>&nbsp;</div></div>
        <div class="culmn">
            <header id="main_menu" class="header navbar-fixed-top">
                <div class="main_menu_bg">
                    <div class="container">
                        <div class="row">
                            <div class="nave_menu">
                                <nav class="navbar navbar-default">
                                    <div class="container-fluid">
                                        <!-- Brand and toggle get grouped for better mobile display -->
                                        <div class="navbar-header">
                                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                                                <span class="sr-only">Toggle navigation</span>
                                                <span class="icon-bar"></span>
                                                <span class="icon-bar"></span>
                                                <span class="icon-bar"></span>
                                            </button>
                                            <a class="navbar-brand" href="#home">
                                                <img src="assets/images/logo.png"/>
                                            </a>
                                        </div>
                                        <!-- Collect the nav links, forms, and other content for toggling -->
                                        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                                            <ul class="nav navbar-nav navbar-right">
                                                <li><a href="index.html">Home</a></li>
                                                <li><a href="#roomfinder">RoomFinder</a></li>
                                                <li><a href="funding.html">Funding</a></li>
                                                <li><a href="team.html">Team</a></li>
                                                <li><a href="contact.html">Contact</a></li>
                                                <li>
                                                    <a href="#"  data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                                        <i class="fa fa-search"></i>
                                                    </a>
                                                    <ul class="dropdown-menu">
                                                        <li>
                                                          <form class="navbar-form" role="search" onsubmit='loadSearch();'>
                                                              <div class="form-group">
                                                                  <input type="text" id = "SearchBar" class="search-form-control" placeholder="Search">
                                                              </div>
                                                          </form>
                                                        </li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </header> <!--End of header -->

            <section id="roomfinder" class="home">
                <div class="overlay all_overlay">
                    <div class="row">
                        <div class="col-sm-12 ">
                            <div class="text-center">
                                <div class="main_home wow fadeInUp" data-wow-duration="700ms">
                                    <div class="custom-h4">Welcome to </div>
                                    <br>
                                    <br>
                                    <br>
                                    <p class = "custom">McCormick Student Advisory Board</p>

                                    <div class="whiteseparator"></div>
                                    <div class="home_btn">
                                        <a href="#about" class="main-btn main-btn-primary">ABOUT US</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="about" class="about">
                <div class="container">
                    <div class="row">
                        <div class="sections text-center">
                            <div class="col-sm-10 col-sm-offset-1">
                                <div class="head_title text-center">
                                    <div class="subtitle custom-h4">Need a place to study in tech?</div>
                                    <h2>Tech Study Space Finder!</h2>
                                    <div class="separator"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row text-center" style="margin-bottom: 1.5em">
                        <p>Enter time and date here to see available study spaces in Tech Institute! </p>
                    </div>
                    <div class="row text-center" style="width:250px; margin: auto auto 1.5em;">
                        <div id='timeSelection'></div>
                    </div>
                    <div class="row text-center" style="width:650px; margin:auto" id="availablerooms">
                    </div>
                    <div class="result-padding" style="margin-bottom: 15em"></div>
                </div>
            </section>
            <footer id="footer" class="footer">
                <div class="container">
                    <div class="main_footer text-center">
                        <div class="row">
                            <div class="col-sm-12 col-xs-12">
                                <div class="copyright_text">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>

        <!-- START SCROLL TO TOP  -->

        <div class="scrollup">
            <a href="#"><i class="fa fa-chevron-up"></i></a>
        </div>

        <script src="assets/js/vendor/jquery-1.11.2.min.js"></script>
        <script src="assets/js/vendor/bootstrap.min.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>

        <script src="assets/js/jquery.mixitup.min.js"></script>
        <script src="assets/js/jquery.easing.1.3.js"></script>
        <script src="assets/js/jquery.masonry.min.js"></script>
        <script src="assets/js/jquery.fancybox.pack.js"></script>
        <!--This is link only for gmaps-->
        <script src="http://maps.google.com/maps/api/js"></script>
        <script src="assets/js/gmaps.min.js"></script>

        <script>
            Date.prototype.toIsoString = function() {
                var tzo = -this.getTimezoneOffset(),
                    dif = tzo >= 0 ? '+' : '-',
                    pad = function(num) {
                        var norm = Math.floor(Math.abs(num));
                        return (norm < 10 ? '0' : '') + norm;
                    };
                return this.getFullYear() +
                    '-' + pad(this.getMonth() + 1) +
                    '-' + pad(this.getDate()) +
                    'T' + pad(this.getHours()) +
                    ':' + pad(this.getMinutes()) +
                    ':' + pad(this.getSeconds()) +
                    dif + pad(tzo / 60) +
                    ':' + pad(tzo % 60);
            };

            Formio.createForm(document.getElementById('timeSelection'), {
                "display": "form",
                "components": [
                    {
                        "mask": false,
                        "tableView": true,
                        "type": "datetime",
                        "label": "Start Time",
                        "input": true,
                        "key": "dateTime",
                        "suffix": true,
                        "defaultValue": "",
                        "widget": {
                            "type": "calendar",
                            "displayInTimezone": "viewer",
                            "language": "en",
                            "useLocaleSettings": false,
                            "allowInput": true,
                            "mode": "single",
                            "enableTime": true,
                            "noCalendar": false,
                            "format": "yyyy-MM-dd hh:mm a",
                            "defaultDate": "",
                            "hourIncrement": 1,
                            "minuteIncrement": 15,
                            "time_24hr": false,
                            "minDate": "",
                            "maxDate": ""
                        },
                        "datePicker": {
                            "minDate": "",
                            "maxDate": ""
                        },
                        "timePicker": {
                            "minuteStep": 15
                        },
                        "validate": {
                            "unique": false,
                            "customMessage": "",
                            "json": "",
                            "custom": "var time = moment(input, 'yyyy-MM-dd hh:mm a');\nvalid = ((time.minutes() % 15) === 0) ? true : 'Please round to the nearest 15 minutes';"
                        },
                        "customDefaultValue": "const roundedDown = Math.floor(moment().minute() / 15) * 15;\nvalue = moment().minute(roundedDown).second(0);"
                    },
                    {
                        "label": "Duration",
                        "mask": false,
                        "tableView": true,
                        "type": "select",
                        "input": true,
                        "key": "duration",
                        "validate": {
                            "unique": false,
                            "customMessage": "",
                            "json": ""
                        },
                        "data": {
                            "values": [
                                {
                                    "label": "15 minutes",
                                    "value": "15Minutes"
                                },
                                {
                                    "label": "30 minutes",
                                    "value": "30Minutes"
                                },
                                {
                                    "label": "60 minutes",
                                    "value": "60Minutes"
                                }
                            ]
                        },
                        "defaultValue": "15Minutes",
                        "properties": {},
                        "tags": [],
                        "valueProperty": "value"
                    },
                    {
                        "theme": "success",
                        "shortcut": "",
                        "disableOnInvalid": true,
                        "mask": false,
                        "tableView": true,
                        "type": "button",
                        "label": "Find Study Space",
                        "key": "submit",
                        "input": true
                    }
                ],
                "settings": {
                    "pdf": {
                        "id": "1ec0f8ee-6685-5d98-a847-26f67b67d6f0",
                        "src": "https://files.form.io/pdf/5692b91fd1028f01000407e3/file/1ec0f8ee-6685-5d98-a847-26f67b67d6f0"
                    }
                }
            }).then(function(form) {
                form.on('submit', function(submission) {
                    var start = new Date(submission.data.dateTime);
                    var end;
                    if(submission.data.duration === "15Minutes"){
                        end = new Date(start.getTime() + 15*60000);
                    }
                    else if(submission.data.duration === "30Minutes"){
                        end = new Date(start.getTime() + 30*60000);
                    }
                    else if(submission.data.duration === "60Minutes") {
                        end = new Date(start.getTime() + 60*60000);
                    }
                    else{
                        // default to 30 minutes
                        end = new Date(start.getTime() + 30*60000);
                    }
                    // reports local time with UTC offset
                    queryAvailability(start.toIsoString(), end.toIsoString());
                })});
        </script>


        <script>
            function queryAvailability(start, end){
				var availablerooms = document.getElementById("availablerooms");
				// Clear webpage display before querying to make sure that the displayed data is always up-to-date
                while (availablerooms.firstChild) {
                    availablerooms.removeChild(availablerooms.firstChild);
                }
                var xmldoc = document.implementation.createDocument("http://www.collegenet.com/r25", "r25:space_availability", null);
                var rooms = [233, 1282, 1251, 126, 127, 128, 129, 130, 131, 132, 12, 101, 102, 103, 104, 105, 106,
                193, 194, 195, 196, 108, 180, 181, 182, 183, 184, 185, 186, 299];
                rooms.forEach(appendRoom);
                function appendRoom(value){
                    var requirement = xmldoc.createElement("r25:requirements");
                    var space = xmldoc.createElement("r25:space");
                    var space_id = xmldoc.createElement("r25:space_id");
                    space_id.appendChild(xmldoc.createTextNode(value));
                    space.appendChild(space_id);
                    requirement.appendChild(space);
                    xmldoc.documentElement.appendChild(requirement);
                }
                var dates = xmldoc.createElement("r25:dates");
                var start_dt = xmldoc.createElement("r25:start_dt");
                var end_dt = xmldoc.createElement("r25:end_dt");
                // TODO: server might not parse local times properly
                start_dt.appendChild(xmldoc.createTextNode(start));
                end_dt.appendChild(xmldoc.createTextNode(end));
                dates.appendChild(start_dt);
                dates.appendChild(end_dt);
                xmldoc.documentElement.appendChild(dates);
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.open("POST", "proxy.php");
                xmlhttp.setRequestHeader("Content-type", "text/xml");
                xmlhttp.onreadystatechange = function(){
                    if (this.readyState === 4 && this.status === 200){
                        var rooms = xmlhttp.responseXML.getElementsByTagNameNS("http://www.collegenet.com/r25", "space");
                        var arr = [];
                        for (let i = 0; i < rooms.length; i++){
                            var room = rooms[i];
                            var avl = room.getElementsByTagNameNS("http://www.collegenet.com/r25", "available_dates")[0];
                            if (avl.textContent !== "0"){
                                // Room is available, push to array
                                arr.push(room.getElementsByTagNameNS("http://www.collegenet.com/r25", "formal_name")[0].textContent);
                            }
                        }
                        createTable(arr);
                    }
                };
                xmlhttp.send(xmldoc);
            }
            function createTable(tableData) {
                var table = document.createElement('table');
                var att = document.createAttribute("class");
                att.value = "minimalistBlack";
                table.setAttributeNode(att);
                var tableBody = document.createElement('tbody');
                var row, cell;

                tableData.forEach(function(data, index, array) {
                    if (index % 3 === 0) {
                        row = document.createElement('tr');
                        cell = document.createElement('td');
                        cell.appendChild(document.createTextNode(data));
                        row.appendChild(cell);
                        tableBody.appendChild(row);
                    }
                    else{
                        cell = document.createElement('td');
                        cell.appendChild(document.createTextNode(data));
                        row.appendChild(cell);
                    }
                });

                table.appendChild(tableBody);
                var availablerooms = document.getElementById("availablerooms");
                availablerooms.appendChild(table);
            }
        </script>
        <script src="assets/js/plugins.js"></script>
        <script src="assets/js/main.js"></script>

    </body>
</html>
